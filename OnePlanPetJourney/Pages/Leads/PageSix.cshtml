@page "{id:int}"
@model OnePlanPetJourney.Pages.Leads.PageSevenModel

@{
    ViewData["Title"] = "Page Seven - Address Details";
    ViewData["CurrentStep"] = 7;
}

@if (TempData["Message"] is string msg)
{
    <div class="alert alert-success">@msg</div>
}

<div class="row">
  <div class="col-md-8 offset-md-2 mb-3">
    <h1>Where should we send things?</h1>
  </div>
</div>

<div class="row">
  <div class="col-md-8 offset-md-2">
    <div class="card frame">
      <div class="card-body">
        <div class="row row-cols-1 row-cols-md-2">
          <h2>Address Details</h2>
        </div>

        <div class="row">
          <!-- Toggle buttons (no form selected by default) -->
          <div class="mb-3">
            <div class="btn-group" role="group" aria-label="Address mode">
              <button type="button" id="btnOld"  class="btn btn-outline-primary">Old School</button>
              <button type="button" id="btnTech" class="btn btn-outline-primary">Savvy</button>
            </div>
          </div>

          <!-- OLD SCHOOL: Physical only -->
          <form method="post" id="form-old" class="d-none" novalidate>
            @Html.AntiForgeryToken()
            <input type="hidden" name="Mode" value="old" />
            <input asp-for="AddressInput.leadId" type="hidden" value="@Model.LeadId" />

            <div class="row g-3">
              <div class="col-12">
                <h3 class="mt-2">Physical Address</h3>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalAddressLineOne" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalAddressLineOne" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalAddressLineOne" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalAddressLineTwo" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalAddressLineTwo" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalAddressLineTwo" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalCity" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalCity" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalCity" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalPostalCode" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalPostalCode" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalPostalCode" class="text-danger"></span>
              </div>

              <!-- Keep per-form submit for parity; hide visually (global Continue will submit visible form) -->
              <div class="col-12 d-none">
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </div>
          </form>

          <!-- TECH SAVVY: Delivery + Physical -->
          <form method="post" id="form-tech" class="d-none" novalidate>
            @Html.AntiForgeryToken()
            <input type="hidden" name="Mode" value="tech" />
            <input asp-for="AddressInput.leadId" type="hidden" value="@Model.LeadId" />

            <div class="row g-3">
              <div class="col-12">
                <h3 class="mt-2">Delivery Address</h3>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.DeliveryAddressLineOne" class="form-label"></label>
                <input asp-for="AddressInput.DeliveryAddressLineOne" class="form-control" />
                <span asp-validation-for="AddressInput.DeliveryAddressLineOne" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.DeliveryAddressLineTwo" class="form-label"></label>
                <input asp-for="AddressInput.DeliveryAddressLineTwo" class="form-control" />
                <span asp-validation-for="AddressInput.DeliveryAddressLineTwo" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.DeliveryCity" class="form-label"></label>
                <input asp-for="AddressInput.DeliveryCity" class="form-control" />
                <span asp-validation-for="AddressInput.DeliveryCity" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.DeliveryPostalCode" class="form-label"></label>
                <input asp-for="AddressInput.DeliveryPostalCode" class="form-control" />
                <span asp-validation-for="AddressInput.DeliveryPostalCode" class="text-danger"></span>
              </div>

              <div class="col-12">
                <h3 class="mt-2">Physical Address</h3>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalAddressLineOne" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalAddressLineOne" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalAddressLineOne" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalAddressLineTwo" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalAddressLineTwo" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalAddressLineTwo" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalCity" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalCity" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalCity" class="text-danger"></span>
              </div>

              <div class="col-md-6">
                <label asp-for="AddressInput.PhysicalPostalCode" class="form-label"></label>
                <input asp-for="AddressInput.PhysicalPostalCode" class="form-control" />
                <span asp-validation-for="AddressInput.PhysicalPostalCode" class="text-danger"></span>
              </div>

              <!-- Keep per-form submit; hidden (global Continue handles submission) -->
              <div class="col-12 d-none">
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Navigation bar (Call me / Previous / Continue) -->
<div class="row">
  <div class="col-md-8 offset-md-2">
    <div class="navigation-container">
      <div class="row">
        <div id="divCallMe" class="col-sm-12 col-md-6 mb-4">
          <button id="btnCallMePopUp"
                  type="button"
                  class="btn btn-block btn-nav-call-me btn-nav btn-nav-properties"
                  data-bs-toggle="modal"
                  data-bs-target="#CallMePopUp">
            <span><img src="~/images/icon-call-me.png" alt=""></span>&nbsp;&nbsp;Call me rather&nbsp;&nbsp;
          </button>
        </div>

        <div id="divPrevious" class="col-sm-12 col-md-3 mb-4">
          <button id="btnPrevious"
                  type="button"
                  class="btn btn-block btn-nav-previous btn-nav btn-nav-properties"
                  onclick="PrevStepSeven()">
            <span><img src="~/images/icon-chev-left.png" alt=""></span>&nbsp;&nbsp;Previous&nbsp;&nbsp;
          </button>
        </div>

        <div id="divContinue" class="col-sm-12 col-md-3 mb-4">
          <!-- Global continue submits whichever form is visible -->
          <button id="btnContinue"
                  type="button"
                  class="btn btn-block btn-nav-continue btn-nav btn-nav-properties"
                  onclick="submitVisibleForm()">
            &nbsp;&nbsp;Continue&nbsp;&nbsp;<span><img src="~/images/icon-chev-right.png" alt=""></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
<script>
  // route back to Page Six with same id
  function PrevStepSeven() {
    const id = '@Model.LeadId';
    window.location.href = '@Url.Page("/Leads/PageSix")' + '/' + id;
  }

  // Enable/disable all fields in a form (hidden forms shouldn't post)
  function setFormEnabled(form, enable) {
    if (!form) return;
    form.querySelectorAll('input, select, textarea, button').forEach(function(el){
      if (el.type === 'hidden') return; // keep hidden (leadId, Mode, antiforgery)
      el.disabled = !enable;
    });
  }

  // Toggle behavior (default: nothing shown)
  const btnOld  = document.getElementById('btnOld');
  const btnTech = document.getElementById('btnTech');
  const formOld = document.getElementById('form-old');
  const formTech= document.getElementById('form-tech');

  function selectMode(mode) {
    if (mode === 'old') {
      btnOld.classList.add('active');
      btnTech.classList.remove('active');
      formOld.classList.remove('d-none');
      formTech.classList.add('d-none');
      setFormEnabled(formOld, true);
      setFormEnabled(formTech, false);
    } else if (mode === 'tech') {
      btnTech.classList.add('active');
      btnOld.classList.remove('active');
      formTech.classList.remove('d-none');
      formOld.classList.add('d-none');
      setFormEnabled(formTech, true);
      setFormEnabled(formOld, false);
    }
  }

  btnOld.addEventListener('click', function (e) {
    e.preventDefault();
    selectMode('old');
  });
  btnTech.addEventListener('click', function (e) {
    e.preventDefault();
    selectMode('tech');
  });

  // Continue submits whichever form is visible
  function submitVisibleForm() {
    if (!formOld.classList.contains('d-none')) {
      formOld.requestSubmit ? formOld.requestSubmit() : formOld.submit();
    } else if (!formTech.classList.contains('d-none')) {
      formTech.requestSubmit ? formTech.requestSubmit() : formTech.submit();
    } else {
      // no mode selected yet: nudge the user
      btnOld.classList.add('btn-primary');
      btnTech.classList.add('btn-primary');
    }
  }

  // initial state: both hidden & disabled
  setFormEnabled(formOld, false);
  setFormEnabled(formTech, false);
</script>

<partial name="_ValidationScriptsPartial" />
}
